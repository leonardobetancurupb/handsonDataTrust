{% extends 'layouts/default/page.html' %}

{% load i18n %}

{% block content %}
{% if token != "Variable not found" %}
    {% load static %}

    <div class="row w-100 ml-4 mt-2 justify-content-between">
      <div class="col-sm-2 shadow-sm p-1 border border-1">
        <div class="nav flex-column nav-pills text-center mt-4" id="v-pills-tab" role="tablist" aria-orientation="vertical">
          <ul class="list-group ml-0">
            <li class="list-group-item list-group-item-action ">
                <a class="text-success" href={% url 'holder:home' %}>Home</a>
              </li >
              <li class="list-group-item list-group-item-action ">
                <a class="text-success" href={% url 'holder:schemas_owner' %}>Datasets</a>
              </li>
              <li class="list-group-item list-group-item-action ">
                <a class="text-success" href={% url 'holder:register_datasets' %}>Create New</a>
              </li>
              <li class="list-group-item list-group-item-action ">
                <a class="text-success" href={% url 'accounts:settings' %}>Settings</a>
              </li>
            </ul>
          </div>
        </div>
        <div class="col-md-9 w-100 vh-100 mt-5 mr-3 align-self-center">
          <div class="ventana-home">
            <div class="lap-home  p-2 border border-1">
              <div class="form-group ">
                <h3>
                  Create New Dataset
                </h3>
                <div class="container mt-5">
                  <form  id="datasetForm">
                    {% csrf_token %}
                    <div class="mb-3">
                      <label for="idCategory" class="form-label">Category</label>
                      <br>
                      {% comment %} <input type="text" class="form-control" id="CategoryInput" placeholder="Propiety"> {% endcomment %}
                      <select name="idCategory" id="idCategory" class="form-select">
                        <!-- Opción por defecto -->
                        <option value="" disabled selected>Select a Category</option>
                      </select>
                    </div>
                    <div class="mb-3">
                      <label for="idPolicy" class="form-label">Policy</label>
                      <br>
                      <select name="idPolicy" id="idPolicy" class="form-select">
                        <!-- Opción por defecto -->
                        <option value="" disabled selected>Select a Policy</option>
                      </select>
                      <button class="btn btn-sm btn-outline-success ml-3" id="viewPolicyBtn" disabled>View policy selected</button>
                    </div>
                    <div class="mb-3">
                      <label for="idSchema" class="form-label">Schema</label>
                      <br>
                      <select name="idSchema" id="idSchema" class="form-select">
                        <!-- Opción por defecto -->
                        <option value="" disabled selected>Select a Schema</option>
                      </select>
                      <button class="btn btn-sm btn-outline-success ml-3" id="viewSchemaBtn" disabled>View schema selected</button>
                      
                    </div>
                    <div class="mb-3">
                      <label for="FormatInput" class="form-label">Format</label>
                      <input class="form-control" type="text" id="FormatInput" value="Excel" aria-label="Excel" disabled readonly>
                    </div>
                    <div class="row mb-3 mt-1">
                      <div class="col-md-6 ">
                        <button class="btn btn-success" onclick="exportToExcel()" id="exportToExcelBtn" disabled>Export template</button>
                      </div>
                      <div class="col-md-6 ">
                        {% comment %} <div class="custom-file-input ml-2">
                          <input type="file" name="archivo" id="fileInput" onchange="updateFileName()">
                          <label for="fileInput" class="custom-file-label ">Choose File</label>
                        </div> {% endcomment %}
                      </div>
                    </div>
                    <div class="d-flex justify-content-end">
                      <button type="submit" class="btn btn-success">Submit</button>
                    </div>
                  </form>
                  <form id="filedataset">
                    {% csrf_token %}
                    <div class="custom-file-input ml-2 mb-2">
                        <input type="file" name="archivo" id="fileInput" onchange="updateFileName()">
                        <label for="fileInput" class="custom-file-label ">Choose File</label>
                    </div>
                    <button type="submit" class="btn btn-success btn-sm">Load file</button>
                </form>
                  
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script src="{% static 'assets/js/manage_datasets.js' %}"></script>
    <script src="{% static 'assets/js/manage_files.js' %}"></script>
    <script>
      function updateFileName() {
          var input = document.getElementById('fileInput');
          var label = input.nextElementSibling; // El elemento <label> sigue al <input> en el DOM
          var fileName = input.files.length > 0 ? input.files[0].name : 'Choose File';
          label.textContent = fileName;
      }
  </script>
  <script>
    document.getElementById('idSchema').addEventListener('change', function() {
        var select = document.getElementById('idSchema');
        var button = document.getElementById('viewSchemaBtn');
        var buttonExport = document.getElementById('exportToExcelBtn');
        if (select.value) {
            button.disabled = false;
            buttonExport.disabled = false; // Habilita el botón si se selecciona una opción
        } else {
            button.disabled = true; // Deshabilita el botón si no hay ninguna opción seleccionada
            buttonExport.disabled = true;
        }
    });
    document.getElementById('idPolicy').addEventListener('change', function() {
      var select = document.getElementById('idPolicy');
      var button = document.getElementById('viewPolicyBtn');
      if (select.value) {
          button.disabled = false; // Habilita el botón si se selecciona una opción
      } else {
          button.disabled = true; // Deshabilita el botón si no hay ninguna opción seleccionada
      }
  });
</script>
  {% else %}
    <script>
      window.onload = function () {
        window.location.href = "{% url 'accounts:log_in' %}"
      }
    </script>
  {% endif %}
{% endblock %}
